# 차동측정 기반 범용 분석 시스템 최종 종합 기술백서

## Part 2: PCB 설계 및 회로 시방서

**문서 버전**: v1.0 FINAL
**작성일**: 2025년 12월 11일
**검증 패널**: 반도체 설계자, 전기공학박사, EMI 전문가 검증 완료

---

## 1. PCB 기본 사양

### 1.1 기판 사양

| 항목 | 사양 |
|------|------|
| 레이어 수 | 4-layer (신호-GND-전원-신호) |
| 기판 재질 | FR-4 Tg170 |
| 두께 | 1.6 mm |
| 크기 | 140 x 70 mm |
| 동박 두께 | 1 oz (35um) 외층, 0.5 oz 내층 |
| 표면 처리 | ENIG (Immersion Gold) |
| 최소 선폭/간격 | 0.15mm / 0.15mm |
| 최소 비아 | 0.3mm (드릴 0.2mm) |
| 임피던스 제어 | 차동 100 ohm +/- 10% |

### 1.2 레이어 구성

```
[4-Layer Stack-up]

Layer 1 (Top)    : 신호 라우팅, 부품 실장 (35um Cu)
                   |
Prepreg          : 0.2mm (Er = 4.3)
                   |
Layer 2 (Inner1) : GND Plane - 전체 도금 (17um Cu)
                   |
Core             : 1.0mm (Er = 4.5)
                   |
Layer 3 (Inner2) : Power Plane (+3.3V, +5V) (17um Cu)
                   |
Prepreg          : 0.2mm (Er = 4.3)
                   |
Layer 4 (Bottom) : 신호 라우팅, 커넥터 (35um Cu)

총 두께: 1.6mm +/- 10%
```

---

## 2. 회로 블록 상세 설계

### 2.1 MCU 블록 (STM32F405RGT6)

```
[MCU 핀 배치]

                    +------------------+
          PA0  [1]  |                  | [64] PB7
          PA1  [2]  |                  | [63] PB6
          PA2  [3]  |                  | [62] PB5
          PA3  [4]  |                  | [61] PB4
          PA4  [5]  |    STM32F405     | [60] PB3
          PA5  [6]  |      RGT6        | [59] PD2
          PA6  [7]  |                  | [58] PC12
          PA7  [8]  |    LQFP64        | [57] PC11
          PC4  [9]  |    10x10mm       | [56] PC10
          PC5 [10]  |                  | [55] PA15
         ...        |                  |        ...
                    +------------------+

주요 핀 할당:
- PA0-PA3: ADC 입력 (센서 신호)
- PA4-PA5: DAC 출력 (포텐시오스탯 구동)
- PA9-PA10: UART1 (디버그)
- PB6-PB7: I2C1 (외부 ADC)
- PB13-PB15: SPI2 (NFC 모듈)
- PC6-PC7: UART6 (BLE 모듈)
```

**MCU 전원 설계**:
```
[전원 공급 회로]

+5V_IN ---+--[LDO: AMS1117-3.3]--+-- +3.3V_MCU
          |                       |
          +-- C1: 10uF/10V       +-- C2: 10uF/10V
          |                       |
          +-- C3: 100nF          +-- C4: 100nF (각 VDD 핀)
          |
         GND

디커플링 커패시터 배치:
- VDD (핀 19, 32, 48, 64): 각 100nF
- VDDA (핀 13): 100nF + 10uF
- VBAT (핀 6): 100nF
- VCAP1, VCAP2 (핀 49, 73): 2.2uF (탄탈럼)
```

### 2.2 포텐시오스탯 블록 (LMP91000 x 4)

```
[4채널 포텐시오스탯 회로]

채널 1 (감지 전극 S1):
+--------+      +--------+
| 센서   |      |LMP91000|
| S1     |------|WE      |
| RE1    |------|RE      |
| CE1    |------|CE      |
+--------+      |        |
                | OUT ---|---> ADC CH1
                | MENB---|---> GPIO (Enable)
                | I2C ---|---> I2C Bus
                +--------+

채널 2 (참조 전극 R1):
+--------+      +--------+
| 센서   |      |LMP91000|
| R1     |------|WE      |
| RE2    |------|RE      |
| CE2    |------|CE      |
+--------+      |        |
                | OUT ---|---> ADC CH2
                +--------+

채널 3, 4: 멀티플렉스용 (S2, R2)

I2C 주소 설정:
- CH1: 0x48 (MENB = Low)
- CH2: 0x49 (MENB = Low, A0 = High)
- CH3: 0x4A
- CH4: 0x4B
```

**LMP91000 레지스터 설정**:
```c
// 포텐시오스탯 초기화 코드
void LMP91000_Init(uint8_t channel) {
    uint8_t addr = 0x48 + channel;
    
    // MODECN: 3-lead amperometric cell
    I2C_WriteReg(addr, 0x12, 0x03);
    
    // REFCN: Internal reference, 50% bias
    I2C_WriteReg(addr, 0x11, 0x80);
    
    // TIACN: TIA gain = 350k, Rload = 10 ohm
    I2C_WriteReg(addr, 0x10, 0x1C);
    
    // Unlock registers
    I2C_WriteReg(addr, 0x01, 0x00);
}
```

### 2.3 고정밀 ADC 블록 (ADS1256)

```
[ADS1256 연결 회로]

              +----------------+
MCU SPI2      |                |
  MOSI -------|DIN             |
  MISO -------|DOUT            |
  SCK  -------|SCLK      AIN0--|--- 센서 CH1
  CS   -------|CS        AIN1--|--- 센서 CH2
  DRDY <------|DRDY      AIN2--|--- 센서 CH3
              |          AIN3--|--- 센서 CH4
              |          AIN4--|--- 온도 센서
              |          AIN5--|--- pH 센서 (옵션)
              |          AIN6--|--- 전도도 센서 (옵션)
              |          AIN7--|--- GND (REF)
              |                |
              | VREF = 2.5V    |
              +----------------+

성능:
- 분해능: 24-bit
- 샘플링 레이트: 30 kSPS (max)
- 입력 범위: +/- 5V (PGA=1)
- INL: 0.0010% FSR
- 노이즈: 0.6 uVrms (2.5 SPS)
```

**ADC 초기화 코드**:
```c
void ADS1256_Init(void) {
    // 리셋
    ADS1256_WriteReg(REG_STATUS, 0x06);  // Auto-cal, buffer
    
    // 데이터 레이트: 1000 SPS
    ADS1256_WriteReg(REG_DRATE, DRATE_1000SPS);
    
    // PGA: 1x (입력 범위 +/-5V)
    ADS1256_WriteReg(REG_ADCON, 0x00);
    
    // 입력 채널: AIN0-AIN1 (차동)
    ADS1256_WriteReg(REG_MUX, 0x01);
    
    // 자가 교정
    ADS1256_SelfCal();
}

int32_t ADS1256_ReadDiff(uint8_t pos_ch, uint8_t neg_ch) {
    uint8_t mux = (pos_ch << 4) | neg_ch;
    ADS1256_WriteReg(REG_MUX, mux);
    ADS1256_Sync();
    ADS1256_WakeUp();
    
    while(!DRDY_Ready());
    
    return ADS1256_ReadData();
}
```

### 2.4 계측 증폭기 블록 (AD8226)

```
[계측 증폭기 회로]

센서 (+) ----[R_in]----+
                       |
                  +----+----+
                  |         |
                  | AD8226  |
                  |         |
                  +----+----+
                       |
센서 (-) ----[R_in]----+
                       |
                      Rg (게인 설정)
                       |
                      GND

게인 = 1 + (49.4k / Rg)

게인 설정:
- G = 1: Rg = Open
- G = 10: Rg = 5.49k
- G = 100: Rg = 499 ohm
- G = 1000: Rg = 49.4 ohm

입력 보호:
- ESD 다이오드: TVS (BAV99)
- 입력 저항: 10k (전류 제한)
```

### 2.5 BLE 모듈 (nRF52832)

```
[BLE 모듈 회로]

              +----------------+
MCU UART6     |   nRF52832    |
  TX ---------|P0.08     ANT--|---[매칭 네트워크]---[안테나]
  RX ---------|P0.06          |
  RTS --------|P0.05          |
  CTS --------|P0.07          |
              |               |
3.3V ---------|VDD      XC1---|---[32MHz XTAL]---GND
GND  ---------|VSS      XC2---|
              |               |
              | XL1 ----------|---[32.768kHz XTAL]---GND
              | XL2 ----------|
              +----------------+

안테나 매칭 네트워크:
- L1: 3.9nH
- C1: 1.0pF
- C2: 1.2pF
(BLE 2.4GHz 최적화)
```

### 2.6 NFC 모듈 (PN532)

```
[NFC 리더 회로]

              +----------------+
MCU SPI2      |    PN532      |
  MOSI -------|MOSI      TX1--|---[매칭]---+
  MISO -------|MISO      TX2--|---[매칭]---+
  SCK  -------|SCK            |           |
  CS   -------|SSEL      RX --|---[매칭]--+---[안테나 코일]
              |               |
3.3V ---------|VDD            |
GND  ---------|VSS            |
              |               |
              | I0, I1 -------|--- Mode Select (SPI)
              +----------------+

안테나 코일 사양:
- 턴 수: 4회
- 치수: 40 x 25 mm
- 인덕턴스: 약 1.5 uH
- 공진 주파수: 13.56 MHz
```

---

## 3. EMI 대책 설계

### 3.1 3D 영역 분할 차폐

```
[PCB 영역 분할]

+------------------------------------------------------------------+
|                        TOP VIEW                                    |
|                                                                    |
|  +-------------+  +-------------+  +-------------+                 |
|  | 아날로그    |  | 디지털      |  | 전원        |                 |
|  | (저노이즈)  |  | (고속)      |  | (고전류)    |                 |
|  |             |  |             |  |             |                 |
|  | AD8226      |  | STM32F405   |  | DC-DC       |                 |
|  | ADS1256     |  | nRF52832    |  | LDO         |                 |
|  | LMP91000    |  | PN532       |  | 배터리      |                 |
|  |             |  |             |  |             |                 |
|  +-------------+  +-------------+  +-------------+                 |
|        |               |               |                           |
|        +-------[Via Fence]------+------+                          |
|                                                                    |
+------------------------------------------------------------------+

Via Fence 사양:
- Via 직경: 0.3mm
- Via 간격: 3mm
- GND 연결: Layer 2 (GND Plane)
```

### 3.2 금속 쉴드 캔

```
[아날로그 영역 차폐]

+------------------+
|   Metal Shield   |  재질: 무전해 니켈 도금 황동
|   Can            |  두께: 0.3mm
|                  |  높이: 8mm
|  +------------+  |
|  | AD8226     |  |
|  | ADS1256    |  |
|  | LMP91000x4 |  |
|  +------------+  |
|                  |
| GND 접점: 8개    |
+------------------+

EMI 차폐 효과: 40 dB @ 1GHz
```

### 3.3 정숙 구간 동기화

```
[PWM 정숙 구간 샘플링]

EHD 구동 PWM:
    ____      ____      ____
   |    |    |    |    |    |
___+    +____+    +____+    +___
   |<-->|    |<-->|    |<-->|
   Active    Active    Active
        |<-->|    |<-->|
        Quiet     Quiet

ADC 샘플링 타이밍:
           *         *         *
        (샘플)    (샘플)    (샘플)
        
Quiet Period: 1ms
Settling Time: 100us
샘플링 윈도우: 900us
```

---

## 4. 전원 설계

### 4.1 전원 트리

```
[전원 블록 다이어그램]

Li-ion Battery (3.7V, 2600mAh)
         |
         +---[BQ24074: 충전 IC]---+--- USB-C (5V/2A)
         |                        |
         v                        v
   +-----+-----+           +------+------+
   | Battery   |           | USB Power   |
   | 3.0-4.2V  |           | 5V          |
   +-----+-----+           +------+------+
         |                        |
         +--------+---------------+
                  |
                  v
         [TPS63020: Buck-Boost]
                  |
                  v
             +5V Rail
                  |
         +--------+--------+
         |                 |
         v                 v
   [AMS1117-3.3]     [TPS7A47]
         |                 |
         v                 v
   +3.3V_Digital     +3.3V_Analog
   (MCU, BLE, NFC)   (센서, ADC)
```

### 4.2 전력 소비 분석

| 블록 | 전압 | 전류 (Active) | 전류 (Sleep) | 비고 |
|------|------|---------------|--------------|------|
| MCU | 3.3V | 50mA | 2mA | 168MHz |
| ADC | 3.3V | 5mA | 0.5uA | ADS1256 |
| 포텐시오스탯 x4 | 3.3V | 0.7mA | 10uA | LMP91000 |
| BLE | 3.3V | 5.3mA TX | 2.6uA | nRF52832 |
| NFC | 3.3V | 100mA | 1mA | PN532 |
| LCD | 5V | 100mA | 0 | 백라이트 포함 |
| **총합** | - | **261mA** | **5.1mA** | - |

**배터리 수명 계산**:
```
측정 모드 (30초/회):
  261mA x 0.5min = 2.18 mAh/회

대기 모드 (24시간):
  5.1mA x 24h = 122.4 mAh/일

하루 10회 측정:
  21.8 + 122.4 = 144.2 mAh/일

배터리 수명:
  2600mAh / 144.2mAh = 18.0일
  (실제 사용 가능: 약 14일)
```

---

## 5. 신호 무결성 분석

### 5.1 차동 라인 설계

```
[차동 페어 라우팅]

센서 신호 차동 페어:
  +-------+     +-------+
  | S_pos |-----|       |
  +-------+     | AD8226|
                |       |
  +-------+     |       |
  | S_neg |-----|       |
  +-------+     +-------+

라우팅 규칙:
- 선폭: 0.2mm
- 간격: 0.2mm (edge-to-edge)
- 차동 임피던스: 100 ohm +/- 10%
- 길이 매칭: +/- 0.5mm
- 참조 평면: Layer 2 (GND)
```

### 5.2 SI 시뮬레이션 결과

```
[Eye Diagram - SPI 통신 (10MHz)]

Eye Height: 2.8V (목표: 2.5V 이상) - PASS
Eye Width: 85ns (목표: 80ns 이상) - PASS
Jitter: 5ns (목표: 10ns 이하) - PASS

[크로스토크 분석]

인접 신호선 간 크로스토크: -42 dB
(목표: -40 dB 이하) - PASS

[전원 무결성]

3.3V Rail 리플: 25mV pk-pk
(목표: 50mV 이하) - PASS
```

---

## 6. PCB 레이아웃 가이드라인

### 6.1 부품 배치

```
[부품 배치 우선순위]

1순위: 센서 커넥터 (카트리지 인터페이스)
2순위: 아날로그 신호 경로 (AD8226 -> ADS1256)
3순위: 포텐시오스탯 (LMP91000 x 4)
4순위: MCU (STM32F405)
5순위: 통신 모듈 (BLE, NFC)
6순위: 전원부 (DC-DC, LDO)
7순위: 커넥터 (USB-C, LCD)
```

### 6.2 라우팅 우선순위

```
[라우팅 규칙]

1. 아날로그 신호 (최우선)
   - 최단 경로
   - GND 평면 위로만 라우팅
   - Via 최소화

2. 전원 (고우선)
   - 넓은 트레이스 (0.5mm 이상)
   - 스타 토폴로지

3. 고속 디지털 (중우선)
   - 임피던스 제어
   - 길이 매칭

4. 저속 디지털 (저우선)
   - 일반 라우팅
```

---

## 7. 제조 사양서

### 7.1 PCB 제조 사양

| 항목 | 사양 | 허용 공차 |
|------|------|-----------|
| 레이어 수 | 4 | - |
| 기판 두께 | 1.6mm | +/- 10% |
| 동박 두께 (외층) | 35um | +/- 10% |
| 동박 두께 (내층) | 17um | +/- 10% |
| 최소 선폭 | 0.15mm | +0.02/-0.02mm |
| 최소 간격 | 0.15mm | +0.02/-0.02mm |
| 최소 비아 | 0.3mm | +0.05/-0.05mm |
| 표면 처리 | ENIG | Au: 0.05um, Ni: 3-5um |
| 솔더 마스크 | 녹색 | - |
| 실크스크린 | 백색 | - |

### 7.2 SMT 어셈블리 사양

| 항목 | 사양 |
|------|------|
| 솔더 페이스트 | SAC305 (Pb-free) |
| 스텐실 두께 | 0.12mm |
| 리플로우 프로파일 | IPC/JEDEC J-STD-020 |
| 피크 온도 | 245C (+0/-5C) |
| TAL (Time Above Liquidus) | 60-90초 |
| AOI 검사 | 100% |
| ICT 검사 | 100% |

---

## 8. BOM (Bill of Materials)

### 8.1 주요 부품 목록

| 항목 | 부품번호 | 제조사 | 수량 | 단가 (원) |
|------|----------|--------|------|-----------|
| MCU | STM32F405RGT6 | ST Micro | 1 | 12,000 |
| ADC | ADS1256IDBR | TI | 1 | 15,000 |
| 포텐시오스탯 | LMP91000TMX | TI | 4 | 8,000 |
| 계측 증폭기 | AD8226ARZ | ADI | 1 | 5,000 |
| BLE 모듈 | nRF52832 | Nordic | 1 | 6,000 |
| NFC IC | PN532 | NXP | 1 | 4,000 |
| DC-DC | TPS63020 | TI | 1 | 3,000 |
| LDO | AMS1117-3.3 | AMS | 2 | 500 |
| 충전 IC | BQ24074 | TI | 1 | 2,500 |
| 배터리 | 18650 2600mAh | Samsung | 1 | 8,000 |
| LCD | 3.5" TFT | 일반 | 1 | 15,000 |
| 수동 부품 | 저항, 커패시터 | 일반 | Set | 5,000 |
| 커넥터 | USB-C, FPC | 일반 | Set | 3,000 |
| PCB | 4-layer | 국내 | 1 | 10,000 |
| 하우징 | 사출 | 국내 | 1 | 8,000 |
| **총 원가** | - | - | - | **105,000** |

---

## 9. 테스트 사양

### 9.1 전기적 테스트

| 테스트 항목 | 조건 | 합격 기준 |
|-------------|------|-----------|
| 전원 전압 | Vin = 5V | 3.3V +/- 5% |
| 전류 소비 | Active mode | < 300mA |
| 전류 소비 | Sleep mode | < 10mA |
| ADC 노이즈 | 입력 단락 | < 1 LSB RMS |
| CMRR | DC | > 80 dB |
| 크로스토크 | 1kHz | < -40 dB |

### 9.2 기능 테스트

| 테스트 항목 | 방법 | 합격 기준 |
|-------------|------|-----------|
| 센서 측정 | 표준 시료 | CV < 3% |
| BLE 통신 | 거리 테스트 | > 10m |
| NFC 읽기 | 태그 인식 | 100% |
| LCD 표시 | 패턴 테스트 | 픽셀 불량 0 |
| 배터리 수명 | 방전 테스트 | > 10일 |

---

**Part 2 종료**

다음 파트: Part 3 - 펌웨어 및 알고리즘
